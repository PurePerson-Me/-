var collectPlatformKwaixiaodianUnlisted=function(){"use strict";var ne=Object.defineProperty;var te=(m,g,x)=>g in m?ne(m,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):m[g]=x;var C=(m,g,x)=>te(m,typeof g!="symbol"?g+"":g,x);function m(e){return e==null||typeof e=="function"?{main:e}:e}const g=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),x=new Map(g);class O extends Error{constructor(r){super(O._prepareSuperMessage(r));C(this,"name","NonError")}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const J=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],M=new WeakSet,z=e=>{M.add(e);const n=e.toJSON();return M.delete(e),n},S=e=>x.get(e)??Error,P=({from:e,seen:n,to:r,forceEnumerable:u,maxDepth:p,depth:f,useToJSON:s,serialize:i})=>{if(!r)if(Array.isArray(e))r=[];else if(!i&&j(e)){const t=S(e.name);r=new t}else r={};if(n.push(e),f>=p)return r;if(s&&typeof e.toJSON=="function"&&!M.has(e))return z(e);const o=t=>P({from:t,seen:[...n],forceEnumerable:u,maxDepth:p,depth:f,useToJSON:s,serialize:i});for(const[t,a]of Object.entries(e)){if(a&&a instanceof Uint8Array&&a.constructor.name==="Buffer"){r[t]="[object Buffer]";continue}if(a!==null&&typeof a=="object"&&typeof a.pipe=="function"){r[t]="[object Stream]";continue}if(typeof a!="function"){if(!a||typeof a!="object"){try{r[t]=a}catch{}continue}if(!n.includes(e[t])){f++,r[t]=o(e[t]);continue}r[t]="[Circular]"}}for(const{property:t,enumerable:a}of J)typeof e[t]<"u"&&e[t]!==null&&Object.defineProperty(r,t,{value:j(e[t])?o(e[t]):e[t],enumerable:u?!0:a,configurable:!0,writable:!0});return r};function B(e,n={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:u=!0}=n;return typeof e=="object"&&e!==null?P({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:u,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function F(e,n={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=n;if(e instanceof Error)return e;if(q(e)){const u=S(e.name);return P({from:e,seen:[],to:new u,maxDepth:r,depth:0,serialize:!1})}return new O(e)}function j(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function q(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var V=Object.defineProperty,W=Object.defineProperties,X=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,Y=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,I=(e,n,r)=>n in e?V(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,R=(e,n)=>{for(var r in n||(n={}))Y.call(n,r)&&I(e,r,n[r]);if(L)for(var r of L(n))H.call(n,r)&&I(e,r,n[r]);return e},N=(e,n)=>W(e,X(n)),T=(e,n,r)=>new Promise((u,p)=>{var f=o=>{try{i(r.next(o))}catch(t){p(t)}},s=o=>{try{i(r.throw(o))}catch(t){p(t)}},i=o=>o.done?u(o.value):Promise.resolve(o.value).then(f,s);i((r=r.apply(e,n)).next())});function G(e){let n,r={};function u(){Object.entries(r).length===0&&(n==null||n(),n=void 0)}let p=Math.floor(Math.random()*1e4);function f(){return p++}return{sendMessage(s,i,...o){return T(this,null,function*(){var t,a,l,b;const h={id:f(),type:s,data:i,timestamp:Date.now()},w=(a=yield(t=e.verifyMessageData)==null?void 0:t.call(e,h))!=null?a:h;(l=e.logger)==null||l.debug(`[messaging] sendMessage {id=${w.id}} ─ᐅ`,w,...o);const _=yield e.sendMessage(w,...o),{res:c,err:d}=_??{err:new Error("No response")};if((b=e.logger)==null||b.debug(`[messaging] sendMessage {id=${w.id}} ᐊ─`,{res:c,err:d}),d!=null)throw F(d);return c})},onMessage(s,i){var o,t,a;if(n==null&&((o=e.logger)==null||o.debug(`[messaging] "${s}" initialized the message listener for this context`),n=e.addRootListener(l=>{var b,h;if(typeof l.type!="string"||typeof l.timestamp!="number"){if(e.breakError)return;const c=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(l)}`);throw(b=e.logger)==null||b.error(c),c}(h=e==null?void 0:e.logger)==null||h.debug("[messaging] Received message",l);const w=r[l.type];if(w==null)return;const _=w(l);return Promise.resolve(_).then(c=>{var d,k;return(k=(d=e.verifyMessageData)==null?void 0:d.call(e,c))!=null?k:c}).then(c=>{var d;return(d=e==null?void 0:e.logger)==null||d.debug(`[messaging] onMessage {id=${l.id}} ─ᐅ`,{res:c}),{res:c}}).catch(c=>{var d;return(d=e==null?void 0:e.logger)==null||d.debug(`[messaging] onMessage {id=${l.id}} ─ᐅ`,{err:c}),{err:B(c)}})})),r[s]!=null){const l=Error(`[messaging] In this JS context, only one listener can be setup for ${s}`);throw(t=e.logger)==null||t.error(l),l}return r[s]=i,(a=e.logger)==null||a.log(`[messaging] Added listener for ${s}`),()=>{delete r[s],u()}},removeAllListeners(){Object.keys(r).forEach(s=>{delete r[s]}),u()}}}for(var y=256,A=[],D=256,E;y--;)A[y]=(y+256).toString(16).substring(1);function K(e){var n=0,r=11;if(!E||y+r>D*2)for(E="",y=0;n<D;n++)E+=A[Math.random()*256|0];return E.substring(y,y+++r)}var U="@webext-core/messaging/window",$="@webext-core/messaging/window/response";function Q(e){const n=e.namespace,r=K();let u=[];const p=(s,i)=>new Promise(o=>{const t=l=>{l.data.type===$&&l.data.namespace===n&&l.data.instanceId!==r&&l.data.message.type===s.type&&(o(l.data.response),a())},a=()=>window.removeEventListener("message",t);u.push(a),window.addEventListener("message",t),window.postMessage({type:U,message:s,senderOrigin:location.origin,namespace:n,instanceId:r},i??"*")}),f=G(N(R({},e),{sendMessage(s,i){return p(s,i)},addRootListener(s){const i=o=>T(this,null,function*(){if(o.data.type!==U||o.data.namespace!==n||o.data.instanceId===r)return;const t=yield s(o.data.message);window.postMessage({type:$,response:t,instanceId:r,message:o.data.message,namespace:n},o.data.senderOrigin)});return window.addEventListener("message",i),()=>window.removeEventListener("message",i)},verifyMessageData(s){return structuredClone(s)}}));return N(R({},f),{removeAllListeners(){f.removeAllListeners(),u.forEach(s=>s()),u=[]}})}const Z=Q({namespace:"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"}),ee=m({main(){const e={},n=Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"responseText");Object.defineProperty(XMLHttpRequest.prototype,"responseText",{get(){const r=n.get.call(this);try{const u=this.responseURL,p=["rest/app/grocery/product/self/detail","rest/app/kwaishop/product/c/detail/h5/componentized"];if(u){const s=new URL(u).pathname;for(const i of p)s.includes(i)&&(e[i]=r,Z.sendMessage("detail",e))}}catch{}return r}})}});function se(){}function v(e,...n){}const re={debug:(...e)=>v(console.debug,...e),log:(...e)=>v(console.log,...e),warn:(...e)=>v(console.warn,...e),error:(...e)=>v(console.error,...e)};return(async()=>{try{return await ee.main()}catch(e){throw re.error('The unlisted script "collect-platform-kwaixiaodian-unlisted" crashed on startup!',e),e}})()}();
collectPlatformKwaixiaodianUnlisted;
