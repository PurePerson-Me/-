var collectPlatformAliexpressUnlisted=function(){"use strict";var ne=Object.defineProperty;var te=(f,g,x)=>g in f?ne(f,g,{enumerable:!0,configurable:!0,writable:!0,value:x}):f[g]=x;var k=(f,g,x)=>te(f,typeof g!="symbol"?g+"":g,x);function f(e){return e==null||typeof e=="function"?{main:e}:e}const g=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),x=new Map(g);class M extends Error{constructor(r){super(M._prepareSuperMessage(r));k(this,"name","NonError")}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const B=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],I=new WeakSet,F=e=>{I.add(e);const n=e.toJSON();return I.delete(e),n},S=e=>x.get(e)??Error,O=({from:e,seen:n,to:r,forceEnumerable:i,maxDepth:c,depth:p,useToJSON:s,serialize:l})=>{if(!r)if(Array.isArray(e))r=[];else if(!l&&L(e)){const t=S(e.name);r=new t}else r={};if(n.push(e),p>=c)return r;if(s&&typeof e.toJSON=="function"&&!I.has(e))return F(e);const o=t=>O({from:t,seen:[...n],forceEnumerable:i,maxDepth:c,depth:p,useToJSON:s,serialize:l});for(const[t,a]of Object.entries(e)){if(a&&a instanceof Uint8Array&&a.constructor.name==="Buffer"){r[t]="[object Buffer]";continue}if(a!==null&&typeof a=="object"&&typeof a.pipe=="function"){r[t]="[object Stream]";continue}if(typeof a!="function"){if(!a||typeof a!="object"){try{r[t]=a}catch{}continue}if(!n.includes(e[t])){p++,r[t]=o(e[t]);continue}r[t]="[Circular]"}}for(const{property:t,enumerable:a}of B)typeof e[t]<"u"&&e[t]!==null&&Object.defineProperty(r,t,{value:L(e[t])?o(e[t]):e[t],enumerable:i?!0:a,configurable:!0,writable:!0});return r};function q(e,n={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:i=!0}=n;return typeof e=="object"&&e!==null?O({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:i,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function z(e,n={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=n;if(e instanceof Error)return e;if(V(e)){const i=S(e.name);return O({from:e,seen:[],to:new i,maxDepth:r,depth:0,serialize:!1})}return new M(e)}function L(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function V(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var W=Object.defineProperty,Y=Object.defineProperties,X=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable,D=(e,n,r)=>n in e?W(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,N=(e,n)=>{for(var r in n||(n={}))G.call(n,r)&&D(e,r,n[r]);if(j)for(var r of j(n))H.call(n,r)&&D(e,r,n[r]);return e},R=(e,n)=>Y(e,X(n)),T=(e,n,r)=>new Promise((i,c)=>{var p=o=>{try{l(r.next(o))}catch(t){c(t)}},s=o=>{try{l(r.throw(o))}catch(t){c(t)}},l=o=>o.done?i(o.value):Promise.resolve(o.value).then(p,s);l((r=r.apply(e,n)).next())});function Q(e){let n,r={};function i(){Object.entries(r).length===0&&(n==null||n(),n=void 0)}let c=Math.floor(Math.random()*1e4);function p(){return c++}return{sendMessage(s,l,...o){return T(this,null,function*(){var t,a,u,h;const E={id:p(),type:s,data:l,timestamp:Date.now()},w=(a=yield(t=e.verifyMessageData)==null?void 0:t.call(e,E))!=null?a:E;(u=e.logger)==null||u.debug(`[messaging] sendMessage {id=${w.id}} ─ᐅ`,w,...o);const P=yield e.sendMessage(w,...o),{res:d,err:m}=P??{err:new Error("No response")};if((h=e.logger)==null||h.debug(`[messaging] sendMessage {id=${w.id}} ᐊ─`,{res:d,err:m}),m!=null)throw z(m);return d})},onMessage(s,l){var o,t,a;if(n==null&&((o=e.logger)==null||o.debug(`[messaging] "${s}" initialized the message listener for this context`),n=e.addRootListener(u=>{var h,E;if(typeof u.type!="string"||typeof u.timestamp!="number"){if(e.breakError)return;const d=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(u)}`);throw(h=e.logger)==null||h.error(d),d}(E=e==null?void 0:e.logger)==null||E.debug("[messaging] Received message",u);const w=r[u.type];if(w==null)return;const P=w(u);return Promise.resolve(P).then(d=>{var m,U;return(U=(m=e.verifyMessageData)==null?void 0:m.call(e,d))!=null?U:d}).then(d=>{var m;return(m=e==null?void 0:e.logger)==null||m.debug(`[messaging] onMessage {id=${u.id}} ─ᐅ`,{res:d}),{res:d}}).catch(d=>{var m;return(m=e==null?void 0:e.logger)==null||m.debug(`[messaging] onMessage {id=${u.id}} ─ᐅ`,{err:d}),{err:q(d)}})})),r[s]!=null){const u=Error(`[messaging] In this JS context, only one listener can be setup for ${s}`);throw(t=e.logger)==null||t.error(u),u}return r[s]=l,(a=e.logger)==null||a.log(`[messaging] Added listener for ${s}`),()=>{delete r[s],i()}},removeAllListeners(){Object.keys(r).forEach(s=>{delete r[s]}),i()}}}for(var y=256,A=[],$=256,_;y--;)A[y]=(y+256).toString(16).substring(1);function Z(e){var n=0,r=11;if(!_||y+r>$*2)for(_="",y=0;n<$;n++)_+=A[Math.random()*256|0];return _.substring(y,y+++r)}var C="@webext-core/messaging/window",J="@webext-core/messaging/window/response";function K(e){const n=e.namespace,r=Z();let i=[];const c=(s,l)=>new Promise(o=>{const t=u=>{u.data.type===J&&u.data.namespace===n&&u.data.instanceId!==r&&u.data.message.type===s.type&&(o(u.data.response),a())},a=()=>window.removeEventListener("message",t);i.push(a),window.addEventListener("message",t),window.postMessage({type:C,message:s,senderOrigin:location.origin,namespace:n,instanceId:r},l??"*")}),p=Q(R(N({},e),{sendMessage(s,l){return c(s,l)},addRootListener(s){const l=o=>T(this,null,function*(){if(o.data.type!==C||o.data.namespace!==n||o.data.instanceId===r)return;const t=yield s(o.data.message);window.postMessage({type:J,response:t,instanceId:r,message:o.data.message,namespace:n},o.data.senderOrigin)});return window.addEventListener("message",l),()=>window.removeEventListener("message",l)},verifyMessageData(s){return structuredClone(s)}}));return R(N({},p),{removeAllListeners(){p.removeAllListeners(),i.forEach(s=>s()),i=[]}})}const b=K({namespace:"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"}),ee=f({main(){const e=r=>r?["mtop.aliexpress.itemdetail.pc.asyncpcdetail","mtop.aliexpress.pdp.pc.query"].some(i=>i.toLowerCase()===r.toLowerCase()):!1;b.onMessage("getPcItemDetail",()=>{var c;const r=(c=window._page_config_)==null?void 0:c.prefetch;if(e(r==null?void 0:r.api)){const p=window.lib.mtop.request(r),s=((r==null?void 0:r.timeout)||15e3)+1e3,l=new Promise((o,t)=>{setTimeout(()=>t(new Error("Request timeout")),s)});Promise.race([p,l]).then(o=>{b.sendMessage("sendPcItemDetail",o)}).catch(()=>{b.sendMessage("sendPcItemDetail",{})})}else b.sendMessage("sendPcItemDetail",{})});const n=fetch;window.fetch=async function(){var i;const r=await n(...arguments);try{const c=arguments[0];(i=c.includes)!=null&&i.call(c,"/bx/pdp/web/productData?productId=")&&r.clone().json().then(s=>{b.sendMessage("getRuPcItemDetail",s)})}catch{}return r}}});function se(){}function v(e,...n){}const re={debug:(...e)=>v(console.debug,...e),log:(...e)=>v(console.log,...e),warn:(...e)=>v(console.warn,...e),error:(...e)=>v(console.error,...e)};return(async()=>{try{return await ee.main()}catch(e){throw re.error('The unlisted script "collect-platform-aliexpress-unlisted" crashed on startup!',e),e}})()}();
collectPlatformAliexpressUnlisted;
